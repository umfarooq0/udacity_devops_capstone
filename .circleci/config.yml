
version: 2.1

orbs:
  aws-cli: circleci/aws-cli@1.4.0

jobs:
  deploy-cfn:
    executor: aws-cli/default
    steps:
      - checkout
      - aws-cli/setup
      - run:
          name: Install aws-iam-authenticator
          command: |
            curl -o aws-iam-authenticator curl -o aws-iam-authenticator https://amazon-eks.s3-us-west-2.amazonaws.com/1.13.7/2019-06-11/bin/linux/amd64/aws-iam-authenticator
            chmod +x ./aws-iam-authenticator
            sudo mv ./aws-iam-authenticator /usr/local/bin/aws-iam-authenticator
      
      - run:
          name: Install kubectl
          command: |
            curl -o kubectl https://amazon-eks.s3-us-west-2.amazonaws.com/1.13.7/2019-06-11/bin/linux/amd64/kubectl
            chmod +x ./kubectl
            mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$PATH:$HOME/bin
            echo 'export PATH=$PATH:$HOME/bin' >> ~/.bashrc
            kubectl version --short --client
      - run:
          name: install eksctl 
          command: |
            curl --silent --location "https://github.com/weaveworks/eksctl/releases/download/0.53.0/eksctl_Linux_amd64.tar.gz" | tar xz -C /tmp \
            sudo mv /tmp/eksctl /usr/local/bin-run  \
            eksctl version
      - run:
          name: create cluster
          command: |
            eksctl create cluster \
            --name my-cluster \
            --fargate
            

      
            
   

                

        
workflows:
  build_all:
    jobs:
      - deploy-cfn:
         context:
            - AWS
